#!/bin/bash

# todo 账户创建后，其他配置可使用aliyun openapi自动化
# 准备工作(aliyun控制台)
# 2. 在组织运营VPC中，添加一个附加网段(10.11.0.0/16)并追加两个交换机(10.11.0.0/24, 10.11.1.0/24)，集群egress节点放在这两个交换机下
# 3. 在组织运营VPC中创建一个NAT网关及一个EIP并绑定，作为集群出口网关。为上述两个交换机网段分别配置SNAT
# 4. 创建新的路由表绑定附加交换机，创建自定义路由条目: 0.0.0.0/0 -> NAT网关，egress节点可访问公网


# 2. 创建名为operator@组织域名的RAM用户并授予管理员权限；为组织创建api RAM用户，授予DNS权限(用于cert-manager的DNS01校验)
# 3. 创建组织级资源组，每个运营/集成地域分别创建VPC专网和交换机(每个可用区一个)
# 4. 运营/集成地域每个VPC内分别创建私网DNS: prod/intgr.it.组织域名(如ouxxa.com)
# 5. 每个组织VPC内创建NAS文件系统IT NAS，用于组织级IT服务器存储VPN网关配置和代理仓库数据
# 6. 为组织创建OSS存储桶，用于组织级软件包存储和下载
# 7. 每个组织VPC中创建ECS(4 * 16 + 40)，实例名为"组织名-IT"，将IT NAS文件系统挂载到/opt目录。创建私网DNS解析到服务器私网IP
# 8. 每个组织VPC中添加自定义路由条目，名为"自建NAT网关"，0.0.0.0/0 下一跳为ECS IT服务器
# 9. 调整ECS所在安全组规则，VPC网段内开放22、80、443端口，workbench网段(100.104.0.0/16)开放22端口，完全开放(0.0.0.0/0)1194端口，全部是TCP
# 10. 使用workbench进入ECS IT终端命令行(内网IP)，执行安装脚本自建NAT网关、OPENVPN网关、证书管理区和代理仓库(nginx + nexus3)

echo "#######################################"
echo "## Start -- 开始安装(aliyun ack cluster)"
echo "#######################################"